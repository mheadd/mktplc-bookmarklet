var DataStore={_db:null,init:function(a){this._db=openDatabase("crossrider_data_"+a,1,"Crossrider Data Store",10485760);this._db.transaction(function(a){a.executeSql("create table if not exists extension_code(data_type varchar(255) primary key, value longtext, app_id integer, version varchar(10), updated_at datetime default (datetime('now','localtime')))",[],function(){},function(){Crossrider.Utils.internalDebug("table create error",arguments)})})},getData:function(a,c){this._db.transaction(function(b){b.executeSql("select data_type,value,version from extension_code where app_id = ?",
[a],function(a,b){for(var h={},f=0;f<b.rows.length;f++){var g=b.rows.item(f);h[g.data_type]={value:g.value,version:g.version}}c(h)}.bind(this),function(){Crossrider.Utils.internalDebug("data load error",arguments)})}.bind(this))},saveApp:function(a,c,b,d){this._db.transaction(function(e){e.executeSql("replace into extension_code (app_id, data_type, value, version, updated_at) values(?, 'app',?,?,datetime('now'))",[a,c,b],function(){"function"===typeof d&&d()},function(){Crossrider.Utils.internalDebug("app save error",
arguments)})})},saveBGApp:function(a,c,b,d){this._db.transaction(function(e){e.executeSql("replace into extension_code (app_id, data_type, value, version, updated_at) values(?, 'bg_script',?,?,datetime('now'))",[a,c,b],function(){"function"===typeof d&&d()},function(){Crossrider.Utils.internalDebug("bg script save error",arguments)})})},saveManifest:function(a,c,b){this._db.transaction(function(d){d.executeSql("replace into extension_code (app_id, data_type, value, updated_at) values(?, 'manifest',?,datetime('now'))",
[a,c],function(){"function"===typeof b&&b()},function(){Crossrider.Utils.internalDebug("manifest save error",arguments)})})},clearData:function(){this._db.transaction(function(a){a.executeSql("drop table extension_code",[],function(){},function(){Crossrider.Utils.internalDebug("extension data clear error",arguments)})})}};
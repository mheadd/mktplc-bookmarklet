var Class=function(a){return function(){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);"function"===typeof this.initialize&&this.initialize.apply(this,arguments)}},XHR=new Class({initialize:function(a){this.options=a;this._method=(this.options.method||"get").toUpperCase();this._data=this.options.data||null;this._type=a.type||"text";this._xhr=new XMLHttpRequest;this._xhr.open(this._method,this.options.url,this.options.async);"POST"===this._method&&this._xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
return this},_onReadyStateChange:function(){if(4===this._xhr.readyState)if(200===this._xhr.status||!this._async&&0===this._xhr.status){var a=this._xhr["xml"===this._type?"responseXML":"responseText"];if(this.options.async&&this.options.callback)this.options.callback({call:"success",response:a});else return a}else if(this.options.async&&this.options.callback)this.options.callback({call:"failure",response:this._xhr.status});else{var b=this.options.url,c=this._xhr.status;if("undefined"!==typeof Crossrider&&
Crossrider.debug)throw chrome.windows.getLastFocused(function(a){"popup"===a.type&&(void 0===a.tabs||0===a.tabs.length)||chrome.tabs.getSelected(a.id,function(a){a&&chrome.tabs.executeScript(a.id,{code:"(function(){throw new Error('loading "+b+" failed with status "+c+"');})();"})})}),Error("loading "+b+" failed with status "+c);return null}},_handleSendException:function(a){Crossrider.Utils.internalDebug("XHR EXCEPTION: "+a.message+", CODE: "+a.code+"\nURL: "+this.options.url+", METHOD: "+this.options.method+
", IS ASYNC: "+this.options.async)},send:function(){if(this.options.async)try{this._xhr.onreadystatechange=this._onReadyStateChange.bind(this),this._xhr.send(this._data)}catch(a){this.options.callback({call:"failure",response:599}),this._handleSendException(a)}else{try{this._xhr.send(this._data)}catch(b){return this._handleSendException(b),null}return this._onReadyStateChange()}}});